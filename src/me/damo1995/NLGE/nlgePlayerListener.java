package me.damo1995.NLGE;

import org.bukkit.Bukkit;
import org.bukkit.ChatColor;
import org.bukkit.Material;
import org.bukkit.block.Block;
import org.bukkit.block.BlockFace;
import org.bukkit.entity.Player;
import org.bukkit.event.EventHandler;
import org.bukkit.event.Listener;
import org.bukkit.event.block.Action;
import org.bukkit.event.player.PlayerInteractEvent;
import org.bukkit.event.player.PlayerJoinEvent;
import org.bukkit.inventory.ItemStack;

public class nlgePlayerListener implements Listener {

	private nlge plugin;

	public nlgePlayerListener(nlge instance) {
		this.plugin = instance;
	}

	@EventHandler
	public void onPlayerInteract(PlayerInteractEvent e) {
		Player player = e.getPlayer();
		Block clicked = e.getClickedBlock();
		// If player clicks nothing or player does not exist //
		if(player == null || clicked == null) return;
		int lightl = clicked.getRelative(BlockFace.UP).getLightLevel();

		ItemStack holding = player.getItemInHand();

		// See if the action is right click and if player is holding bonemeal //
		if (e.getAction() == Action.RIGHT_CLICK_BLOCK
				&& holding.getType() == Material.INK_SACK
				&& holding.getDurability() == 15 && clicked.getType() == Material.GRASS) {
			// See if the clicked block has a light level below 1
			if (clicked.getRelative(BlockFace.UP).getLightLevel() < 1) {
				if (this.plugin.getConfig().getBoolean("debug") == true) {
					player.sendMessage("Debug:" + " " + "Light Level = " + " "
							+ lightl
							+ " "
							+ "Light Level Lower then 1, Event Cancled");
				}
				// See if notify player on use is enabled in config file //
				if (this.plugin.getConfig().getBoolean("notify-use")) {
					player.sendMessage(ChatColor.RED 
							+ this.plugin.getConfig().getString(
							"notify-msg"));
				}
				// See if notify admin on exploit is enabled in config //
				if (this.plugin.getConfig().getBoolean("notify-admin") == true) {
					for (Player onlinePlayer : Bukkit.getServer()
							.getOnlinePlayers()) {
						// Get a list of online players and check if they have permission/op //
						if (onlinePlayer.hasPermission("nlge.admin")
								|| onlinePlayer.isOp()) {
							onlinePlayer.sendMessage(player.getName() + " "
									+ "Attempted to exploit @ " + "X: "
									+ clicked.getX() + " " + "Y: "
									+ clicked.getY() + " " + "Z: "
									+ clicked.getZ());
							this.plugin.logMessage(player.getName() + " "
									+ "Attempted to exploit @ " + "X: "
									+ clicked.getX() + " " + "Y: "
									+ clicked.getY() + " " + "Z: "
									+ clicked.getZ());
						}
					}
				}
				e.setCancelled(true);
				return;
			} else {
				// See if the clicked block has a light level above 1 // 
				if (clicked.getRelative(BlockFace.UP).getLightLevel() > 1) {
					if (this.plugin.getConfig().getBoolean("debug") == true) {
						player.sendMessage("Debug:" 
								+ " " 
								+ "Light Level = "
								+ lightl 
								+ " "
								+ "Higher then 1, Event Continue");

					}
					return;
				}
			}
		}

	}
	@EventHandler
	public void onPlayerJoin(PlayerJoinEvent e){
		if(e.getPlayer().isOp() || e.getPlayer().hasPermission("nlge.admin")){
				if(this.plugin.outdated == true){
			e.getPlayer().sendMessage(ChatColor.GREEN 
			+"[NLGE]: "
			+ ChatColor.RED 
			+"*******OUTDATED******* " 
			+ "Please update!");
		}
				else if(e.getPlayer().isOp() || e.getPlayer().hasPermission("nlge.admin")){
				if(this.plugin.outdated == false){
			e.getPlayer().sendMessage(ChatColor.GREEN 
			+"[NLGE]: "
			+ ChatColor.DARK_GREEN
			+"*******UP-TO-Date*******");
		}
		}
	}
}
}